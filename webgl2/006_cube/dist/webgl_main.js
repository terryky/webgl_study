(()=>{"use strict";let e={load_file_sync:function(e){var t=new XMLHttpRequest;return t.open("GET",e,!1),t.send(null),t},compile_shader_text:function(e,t,r){const n=e.createShader(t);return e.shaderSource(n,r),e.compileShader(n),e.getShaderParameter(n,e.COMPILE_STATUS)?n:(alert("An error occurred compiling the shaders: "+e.getShaderInfoLog(n)),e.deleteShader(n),null)},compile_shader_file:function(t,r,n){const i=e.load_file_sync(n).responseText;return e.compile_shader_text(t,r,i)},link_shaders:function(e,t,r){const n=e.createProgram();return e.attachShader(n,t),e.attachShader(n,r),e.linkProgram(n),e.getProgramParameter(n,e.LINK_STATUS)||alert("Could not initialise shaders"),n},generate_shader:function(t,r,n){const i=e.compile_shader_text(t,t.VERTEX_SHADER,r),o=e.compile_shader_text(t,t.FRAGMENT_SHADER,n),a=e.link_shaders(t,i,o);return t.deleteShader(i),t.deleteShader(o),{program:a,loc_vtx:t.getAttribLocation(a,"a_Vertex"),loc_clr:t.getAttribLocation(a,"a_Color"),loc_nrm:t.getAttribLocation(a,"a_Normal"),loc_uv:t.getAttribLocation(a,"a_TexCoord"),loc_smp:t.getUniformLocation(a,"u_sampler")}}},t={create_texture:function(e){let t=e.createTexture();return e.bindTexture(e.TEXTURE_2D,t),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),t},delete_texture:function(e,t){e.deleteTexture(t)},create_image_texture:function(e,r){let n=t.create_texture(e),i=new Image;return i.crossOrigin="Anonymous",i.onload=function(){e.bindTexture(e.TEXTURE_2D,n),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,!1),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,i),e.generateMipmap(e.TEXTURE_2D)},i.src=r,n},create_image_texture_from_file:function(e,r){let n=t.create_texture(e),i=new Image,o=new FileReader;return i.onload=function(){e.bindTexture(e.TEXTURE_2D,n),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,!1),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,i),e.generateMipmap(e.TEXTURE_2D)},o.onload=function(e){let t=e.target.result;i.src=t},o.readAsDataURL(r),n},create_video_texture:function(e,r){let n={ready:!1};n.texid=t.create_texture(e);let i=document.createElement("video");i.autoplay=!0,i.muted=!0,i.loop=!0;let o=!1,a=!1;function c(){o&&a&&(n.ready=!0)}return i.addEventListener("playing",(function(){o=!0,c()}),!0),i.addEventListener("timeupdate",(function(){a=!0,c()}),!0),i.src=r,i.play(),n.video=i,n},get_video_resolution:function(e){let t=0,r=0;return e.ready&&(t=e.video.videoWidth,r=e.video.videoHeight),{w:t,h:r}},is_video_ready:function(e){return e.ready},update_video_texture:function(e,t){t.ready&&(e.bindTexture(e.TEXTURE_2D,t.texid),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,!1),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,t.video))},create_camera_texture:function(e){let r={ready:!1};r.texid=t.create_texture(e);let n=document.createElement("video");return n.autoplay=!0,n.loop=!0,navigator.mediaDevices=navigator.mediaDevices||navigator.mozGetUserMedia,navigator.webkitGetUserMedia,navigator.mediaDevices?(navigator.mediaDevices.getUserMedia({audio:!1,video:{width:{ideal:640},height:{ideal:480}}}).then((function(e){n.onloadedmetadata=function(){r.ready=!0},n.srcObject=e,n.play()})).catch((function(e){return alert("failed to initialize a camera"),r})),r.video=n,r):(alert("not supported navigator.mediaDevices"),r)},get_camera_resolution:function(e){let t=0,r=0;return e.ready&&(t=e.video.videoWidth,r=e.video.videoHeight),{w:t,h:r}},is_camera_ready:function(e){return e.ready},update_camera_texture:function(e,t){t.ready&&(e.bindTexture(e.TEXTURE_2D,t.texid),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,!1),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,t.video))}},r={vec3_length:function(e){return Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2])},vec2_length:function(e){return Math.sqrt(e[0]*e[0]+e[1]*e[1])},vec3_normalize:function(e){let t,r;if(t=vec3_length(e),0!=t)return r=1/t,e[0]*=r,e[1]*=r,e[2]*=r,t},vec2_normalize:function(e){let t,r;if(t=vec2_length(e),0!=t)return r=1/t,e[0]*=r,e[1]*=r,t},vec2_angle:function(e){return rad=Math.atan2(e[1],e[0]),function(e){return 180*e/Math.PI}(rad)},vec3_calc_screenpos:function(e,t,n,i,o,a,c){let l=[0,0,0,0],u=[0,0,0,0];l[0]=a[0],l[1]=a[1],l[2]=a[2],l[3]=1,r.multvec4(o,l,u);let _=u[0]/u[3],s=u[1]/u[3],d=.5*n,f=.5*i,v=d,m=-f,h=d+e,x=f+t;c[0]=v*_+h,c[1]=m*s+x},turn_x:function(e,t,r){let n,i,o,a,c,l,u,_,s,d,f,v,m,h,x,T;n=e[4],i=e[8],o=e[5],a=e[9],c=e[6],l=e[10],u=e[7],_=e[11],s=t*n,d=r*n,f=t*o,v=r*o,m=t*c,h=r*c,x=t*u,T=r*u,s=r*i+s,d=t*i-d,f=r*a+f,v=t*a-v,m=r*l+m,h=t*l-h,x=r*_+x,T=t*_-T,e[4]=s,e[8]=d,e[5]=f,e[9]=v,e[6]=m,e[10]=h,e[7]=x,e[11]=T},turn_y:function(e,t,r){let n,i,o,a,c,l,u,_,s,d,f,v,m,h,x,T;n=e[0],i=e[8],o=e[1],a=e[9],c=e[2],l=e[10],u=e[3],_=e[11],s=t*n,d=r*n,f=t*o,v=r*o,m=t*c,h=r*c,x=t*u,T=r*u,s=-r*i+s,d=t*i+d,f=-r*a+f,v=t*a+v,m=-r*l+m,h=t*l+h,x=-r*_+x,T=t*_+T,e[0]=s,e[8]=d,e[1]=f,e[9]=v,e[2]=m,e[10]=h,e[3]=x,e[11]=T},turn_z:function(e,t,r){let n,i,o,a,c,l,u,_,s,d,f,v,m,h,x,T;n=e[0],i=e[4],o=e[1],a=e[5],c=e[2],l=e[6],u=e[3],_=e[7],s=t*n,d=r*n,f=t*o,v=r*o,m=t*c,h=r*c,x=t*u,T=r*u,s=r*i+s,d=t*i-d,f=r*a+f,v=t*a-v,m=r*l+m,h=t*l-h,x=r*_+x,T=t*_-T,e[0]=s,e[4]=d,e[1]=f,e[5]=v,e[2]=m,e[6]=h,e[3]=x,e[7]=T},move:function(e,t,r,n){e[12]+=t,e[13]+=r,e[14]+=n},translate:function(e,t,r,n){let i,o,a,c,l,u,_,s,d,f,v,m,h,x,T,E;i=e[0],l=e[4],d=e[8],o=e[1],u=e[5],f=e[9],a=e[2],_=e[6],v=e[10],c=e[3],s=e[7],m=e[11],h=e[12],x=e[13],T=e[14],E=e[15],h+=d*n,x+=f*n,T+=v*n,E+=m*n,h+=l*r,x+=u*r,T+=_*r,E+=s*r,h+=i*t,x+=o*t,T+=a*t,E+=c*t,e[12]=h,e[13]=x,e[14]=T,e[15]=E},rotate:function(e,t,n,i,o){let a,c,l,u,_,s,d,f,v,m,h=[0,0,0];if(a=.017453292222222222*t,c=Math.sin(a),l=Math.cos(a),0==n&&0==i&&0!=o)return o<0&&(c=-c),void r.turn_z(e,l,c);if(0==n&&0!=i&&0==o)return i<0&&(c=-c),void r.turn_y(e,l,c);if(0!=n&&0==i&&0==o)return n<0&&(c=-c),void r.turn_x(e,l,c);{let t,r,a,x,T,E,g,p,A;h[0]=n,h[1]=i,h[2]=o,vec3_normalize(h),u=1-l,f=(n=h[0])*c,v=(i=h[1])*c,m=(o=h[2])*c,_=n*u,s=i*u,d=o*u,t=n*_+l,x=i*_+m,g=o*_-v,r=n*s-m,T=i*s+l,p=o*s+f,a=n*d+v,E=i*d-f,A=o*d+l;{let n,i,o,c,l,u;n=e[0],i=e[4],o=e[8],c=n*t,l=n*r,u=n*a,c+=i*x,l+=i*T,u+=i*E,c+=o*g,l+=o*p,u+=o*A,n=e[1],i=e[5],o=e[9],e[0]=c,e[4]=l,e[8]=u,c=n*t,l=n*r,u=n*a,c+=i*x,l+=i*T,u+=i*E,c+=o*g,l+=o*p,u+=o*A,n=e[2],i=e[6],o=e[10],e[1]=c,e[5]=l,e[9]=u,c=n*t,l=n*r,u=n*a,c+=i*x,l+=i*T,u+=i*E,c+=o*g,l+=o*p,u+=o*A,n=e[3],i=e[7],o=e[11],e[2]=c,e[6]=l,e[10]=u,c=n*t,l=n*r,u=n*a,c+=i*x,l+=i*T,u+=i*E,c+=o*g,l+=o*p,u+=o*A,e[3]=c,e[7]=l,e[11]=u}}},scale:function(e,t,r,n){let i,o,a,c,l,u,_,s,d,f,v,m;i=e[0],l=e[4],d=e[8],o=e[1],u=e[5],f=e[9],a=e[2],_=e[6],v=e[10],c=e[3],s=e[7],m=e[11],i*=t,l*=r,d*=n,o*=t,u*=r,f*=n,a*=t,_*=r,v*=n,c*=t,s*=r,m*=n,e[0]=i,e[4]=l,e[8]=d,e[1]=o,e[5]=u,e[9]=f,e[2]=a,e[6]=_,e[10]=v,e[3]=c,e[7]=s,e[11]=m},modellookat:function(e,t,r,n){let i,o,a,c,l=[0,0];if(l[0]=r[0]-t[0],l[1]=r[2]-t[2],0!=l[0]||0!=l[1]){let e=vec2_normalize(l);i=l[1],o=l[0],l[0]=e,l[1]=r[1]-t[1],vec2_normalize(l),a=l[0],c=l[1]}else i=-1,o=0,a=0,c=r[1]<0?-1:1;if(0==n)e[0]=i,e[4]=o*-c,e[8]=o*a,e[1]=0,e[5]=a,e[9]=c,e[2]=-o,e[6]=i*-c,e[10]=i*a;else{let t,r,l,u;t=Math.cos(n),r=Math.sin(n),l=o*-c,u=i*-c,e[0]=i*t+l*r,e[4]=-i*r+l*t,e[8]=o*a,e[1]=a*r,e[5]=a*t,e[9]=c,e[2]=-o*t+u*r,e[6]=o*r+u*t,e[10]=i*a}e[12]=t[0],e[13]=t[1],e[14]=t[2],e[3]=0,e[7]=0,e[11]=0,e[15]=1},mult:function(e,t,r){let n,i,o,a,c,l,u,_,s,d,f,v,m,h,x,T,E,g,p,A,R,M,U,y;c=r[0],l=r[4],u=r[8],_=r[12],s=r[1],d=r[5],f=r[9],v=r[13],m=r[2],h=r[6],x=r[10],T=r[14],E=r[3],g=r[7],p=r[11],A=r[15],n=t[0],i=t[4],o=t[8],a=t[12],R=n*c,M=n*l,U=n*u,y=n*_,R+=i*s,M+=i*d,U+=i*f,y+=i*v,R+=o*m,M+=o*h,U+=o*x,y+=o*T,R+=a*E,M+=a*g,U+=a*p,y+=a*A,n=t[1],i=t[5],o=t[9],a=t[13],e[0]=R,e[4]=M,e[8]=U,e[12]=y,R=n*c,M=n*l,U=n*u,y=n*_,R+=i*s,M+=i*d,U+=i*f,y+=i*v,R+=o*m,M+=o*h,U+=o*x,y+=o*T,R+=a*E,M+=a*g,U+=a*p,y+=a*A,n=t[2],i=t[6],o=t[10],a=t[14],e[1]=R,e[5]=M,e[9]=U,e[13]=y,R=n*c,M=n*l,U=n*u,y=n*_,R+=i*s,M+=i*d,U+=i*f,y+=i*v,R+=o*m,M+=o*h,U+=o*x,y+=o*T,R+=a*E,M+=a*g,U+=a*p,y+=a*A,n=t[3],i=t[7],o=t[11],a=t[15],e[2]=R,e[6]=M,e[10]=U,e[14]=y,R=n*c,M=n*l,U=n*u,y=n*_,R+=i*s,M+=i*d,U+=i*f,y+=i*v,R+=o*m,M+=o*h,U+=o*x,y+=o*T,R+=a*E,M+=a*g,U+=a*p,y+=a*A,e[3]=R,e[7]=M,e[11]=U,e[15]=y},identity:function(e){e[0]=1,e[4]=0,e[8]=0,e[12]=0,e[1]=0,e[5]=1,e[9]=0,e[13]=0,e[2]=0,e[6]=0,e[10]=1,e[14]=0,e[3]=0,e[7]=0,e[11]=0,e[15]=1},multvec2:function(e,t,r){let n,i,o,a,c,l,u,_,s=t[0],d=t[1];o=e[0],a=e[1],c=e[4],l=e[5],u=e[12],_=e[13],n=u,i=_,n+=c*d,i+=l*d,n+=o*s,i+=a*s,r[0]=n,r[1]=i},multvec4:function(e,t,r){let n,i,o,a,c,l,u,_,s,d,f,v,m,h,x,T,E,g,p,A,R=t[0],M=t[1],U=t[2],y=t[3];n=e[0],c=e[4],s=e[8],m=e[12],i=e[1],l=e[5],d=e[9],h=e[13],o=e[2],u=e[6],f=e[10],x=e[14],a=e[3],_=e[7],v=e[11],T=e[15],E=m*y,g=h*y,p=x*y,A=T*y,E+=s*U,g+=d*U,p+=f*U,A+=v*U,E+=c*M,g+=l*M,p+=u*M,A+=_*M,E+=n*R,g+=i*R,p+=o*R,A+=a*R,r[0]=E,r[1]=g,r[2]=p,r[3]=A},copy:function(e,t){for(let r=0;r<16;r++)e[r]=t[r]},proj_frustum:function(e,t,r,n,i,o,a){e[0]=e[1]=e[2]=e[3]=e[4]=e[5]=e[6]=e[7]=e[8]=e[9]=e[10]=e[11]=e[12]=e[13]=e[14]=e[15]=0,e[0]=2*o/(r-t),e[5]=2*o/(i-n),e[8]=(r+t)/(r-t),e[9]=(i+n)/(i-n),e[10]=-(a+o)/(a-o),e[11]=-1,e[14]=-2*a*o/(a-o)},proj_perspective:function(e,t,r,n,i){let o,a,c,l,u;e[0]=e[1]=e[2]=e[3]=e[4]=e[5]=e[6]=e[7]=e[8]=e[9]=e[10]=e[11]=e[12]=e[13]=e[14]=e[15]=0,u=Math.cos(t/2*6.28/360)/Math.sin(t/2*6.28/360),o=u/r,a=u,c=(i+n)/(n-i),l=2*i*n/(n-i),e[0]=o,e[5]=a,e[10]=c,e[11]=-1,e[14]=l},proj_ortho:function(e,t,r,n,i,o,a){e[0]=e[1]=e[2]=e[3]=e[4]=e[5]=e[6]=e[7]=e[8]=e[9]=e[10]=e[11]=e[12]=e[13]=e[14]=e[15]=0,e[0]=2/(r-t),e[5]=2/(i-n),e[10]=-2/(a-o),e[12]=-(r+t)/(r-t),e[13]=-(i+n)/(i-n),e[14]=-(a+o)/(a-o),e[15]=1},transpose:function(e){let t,r,n,i,o,a,c,l,u,_,s,d;i=e[4],c=e[8],_=e[12],t=e[1],l=e[9],s=e[13],r=e[2],o=e[6],d=e[14],n=e[3],a=e[7],u=e[11],e[1]=i,e[2]=c,e[3]=_,e[4]=t,e[6]=l,e[7]=s,e[8]=r,e[9]=o,e[11]=d,e[12]=n,e[13]=a,e[14]=u},invert:function(e){let t,r,n,i,o,a,c,l,u,_,s,d,f,v,m,h,x,T,E,g,p,A,R,M,U,y,L,P,D,b,S,B,I,F;if(t=e[0],o=e[4],u=e[8],f=e[12],r=e[1],a=e[5],_=e[9],v=e[13],n=e[2],c=e[6],s=e[10],m=e[14],i=e[3],l=e[7],d=e[11],h=e[15],0==i&&0==l&&0==d&&1==h){if(x=a*s-_*c,T=-(r*s-_*n),E=r*c-a*n,I=t*x+o*T+u*E,0==I)return;F=1/I,p=-(o*s-u*c),A=t*s-u*n,R=-(t*c-o*n),U=o*_-u*a,y=-(t*_-u*r),L=t*a-o*r,D=-(x*f+p*v+U*m),b=-(T*f+A*v+y*m),S=-(E*f+R*v+L*m),e[0]=x*F,e[4]=p*F,e[8]=U*F,e[12]=D*F,e[1]=T*F,e[5]=A*F,e[9]=y*F,e[13]=b*F,e[2]=E*F,e[6]=R*F,e[10]=L*F,e[14]=S*F,e[3]=0,e[7]=0,e[11]=0,e[15]=1}else{if(x=a*(s*h-m*d)+_*(m*l-c*h)+v*(c*d-s*l),p=_*(m*i-n*h)+v*(n*d-s*i)+r*(s*h-m*d),U=v*(n*l-c*i)+r*(c*h-m*l)+a*(m*i-n*h),D=r*(c*d-s*l)+a*(s*i-n*d)+_*(n*l-c*i),T=c*(d*f-h*u)+s*(h*o-l*f)+m*(l*u-d*o),A=s*(h*t-i*f)+m*(i*u-d*t)+n*(d*f-h*u),y=m*(i*o-l*t)+n*(l*f-h*o)+c*(h*t-i*f),b=n*(l*u-d*o)+c*(d*t-i*u)+s*(i*o-l*t),E=l*(u*v-f*_)+d*(f*a-o*v)+h*(o*_-u*a),R=d*(f*r-t*v)+h*(t*_-u*r)+i*(u*v-f*_),L=h*(t*a-o*r)+i*(o*v-f*a)+l*(f*r-t*v),S=i*(o*_-u*a)+l*(u*r-t*_)+d*(t*a-o*r),g=o*(_*m-v*s)+u*(v*c-a*m)+f*(a*s-_*c),M=u*(v*n-r*m)+f*(r*s-_*n)+t*(_*m-v*s),P=f*(r*c-a*n)+t*(a*m-v*c)+o*(v*n-r*m),B=t*(a*s-_*c)+o*(_*n-r*s)+u*(r*c-a*n),I=x*t-p*o+U*u-D*f,0==I)return;F=1/I,e[0]=x*F,e[1]=-p*F,e[2]=U*F,e[3]=-D*F,e[4]=-T*F,e[5]=A*F,e[6]=-y*F,e[7]=b*F,e[8]=E*F,e[9]=-R*F,e[10]=L*F,e[11]=-S*F,e[12]=-g*F,e[13]=M*F,e[14]=-P*F,e[15]=B*F}},quaternion_mult:function(e,t,r){let n,i,o,a,c,l,u,_;n=t[0],i=t[1],o=t[2],a=t[3],c=r[0],l=r[1],u=r[2],_=r[3],e[0]=n*c-i*l-o*u-a*_,e[1]=n*l+i*c+o*_-a*u,e[2]=n*u-i*_+o*c+a*l,e[3]=n*_+i*u-o*l+a*c},quaternion_to_matrix:function(e,t){let r,n,i,o,a,c,l,u,_,s,d,f,v;r=t[0],n=t[1],i=t[2],o=t[3],a=2*n*n,c=2*i*i,l=2*o*o,u=2*n*i,_=2*i*o,s=2*o*n,d=2*r*n,f=2*r*i,v=2*r*o,e[0]=1-c-l,e[4]=u-v,e[8]=s+f,e[12]=0,e[1]=u+v,e[5]=1-l-a,e[9]=_-d,e[13]=0,e[2]=s-f,e[6]=_+d,e[10]=1-a-c,e[14]=0,e[3]=e[7]=e[11]=0,e[15]=1},quaternion_rotate:function(e,t,r,n,i){let o=.5*t,a=Math.sin(o);e[0]=Math.cos(o),e[1]=a*r,e[2]=a*n,e[3]=a*i},quaternion_identity:function(e){e[0]=1,e[1]=0,e[2]=0,e[3]=0},quaternion_copy:function(e,t){e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3]}},n=null;const i=[-1,1,1,-1,-1,1,1,1,1,1,-1,1,1,1,-1,1,-1,-1,-1,1,-1,-1,-1,-1,1,1,1,1,-1,1,1,1,-1,1,-1,-1,-1,1,-1,-1,-1,-1,-1,1,1,-1,-1,1,1,1,1,1,1,-1,-1,1,1,-1,1,-1,-1,-1,1,-1,-1,-1,1,-1,1,1,-1,-1],o=[0,0,1,0,0,-1,1,0,0,-1,0,0,0,1,0,0,-1,0],a=[0,0,0,1,1,0,1,1];class c{constructor(){this.gl=null,this.sobj=null,this.vao=null,this.texid=null,this.video=null,this.matPrj=new Array(16),this.count=0}initialize(e){const t=document.querySelector("#glcanvas").getContext("webgl2");t?(t.clearColor(.5,.5,.5,1),this.gl=t):alert("Failed to initialize WebGL2.")}loadScene(){const n=this.gl,o=n.createBuffer();n.bindBuffer(n.ARRAY_BUFFER,o),n.bufferData(n.ARRAY_BUFFER,new Float32Array(i),n.STATIC_DRAW);const c=n.createBuffer();n.bindBuffer(n.ARRAY_BUFFER,c),n.bufferData(n.ARRAY_BUFFER,new Float32Array(a),n.STATIC_DRAW);const l=e.generate_shader(n,"\n    attribute vec4  a_Vertex;\n    attribute vec4  a_Normal;\n    attribute vec2  a_TexCoord;\n    uniform   mat4  u_PMVMatrix;\n    uniform   mat4  u_MVMatrix;\n    uniform   mat4  u_MVITMatrix;\n    varying   vec3  v_diffuse;\n    varying   vec3  v_specular;\n    varying   vec2  v_texcoord;\n    const     float shiness = 16.0;\n    const     vec3  LightPos = vec3(4.0, 4.0, 4.0);\n    const     vec3  LightCol = vec3(0.5, 0.5, 0.5);\n\n    void DirectionalLight (vec3 normal, vec3 eyePos)\n    {\n        vec3  lightDir = normalize (LightPos);\n        vec3  halfV    = normalize (LightPos - eyePos);\n        float dVP      = max(dot(normal, lightDir), 0.0);\n        float dHV      = max(dot(normal, halfV   ), 0.0);\n\n        float pf = 0.0;\n        if(dVP > 0.0)\n            pf = pow(dHV, shiness);\n\n        v_diffuse += dVP * LightCol;\n        v_specular+= pf  * LightCol;\n    }\n\n    void main(void)\n    {\n        gl_Position = u_PMVMatrix * a_Vertex;\n        vec3 normal = normalize(vec3(u_MVITMatrix * a_Normal));\n        vec3 eyePos = normalize(vec3(u_MVMatrix   * a_Vertex));\n\n        v_diffuse  = vec3(0.0);\n        v_specular = vec3(0.0);\n        DirectionalLight(normal, eyePos);\n\n        v_texcoord  = a_TexCoord;\n    }\n","\n    precision mediump float;\n\n    uniform vec3    u_color;\n    uniform float   u_alpha;\n    varying vec3    v_diffuse;\n    varying vec3    v_specular;\n    varying vec2    v_texcoord;\n    uniform sampler2D u_sampler;\n\n    void main(void)\n    {\n        vec3 color;\n        color = vec3(texture2D(u_sampler,  v_texcoord));\n        color += (u_color * v_diffuse);\n        color += v_specular;\n        gl_FragColor = vec4(color, u_alpha);\n    }\n");this.locMtxMV=n.getUniformLocation(l.program,"u_MVMatrix"),this.locMtxPMV=n.getUniformLocation(l.program,"u_PMVMatrix"),this.locMtxMVIT=n.getUniformLocation(l.program,"u_MVITMatrix"),this.locColor=n.getUniformLocation(l.program,"u_color"),this.locAlpha=n.getUniformLocation(l.program,"u_alpha"),r.proj_perspective(this.matPrj,72,640/480,1,1e3);const u=t.create_image_texture(n,"../../assets/webgl.png"),_=t.create_video_texture(n,"../../assets/BigBuckBunny_640x360.mp4");this.sobj=l,this.vboVtx=o,this.vboUv=c,this.texid=u,this.video=_}renderMain(e){let n=this.gl,i=this.sobj,a=this.texid,c=this.count;n.clear(n.COLOR_BUFFER_BIT|n.DEPTH_BUFFER_BIT),n.enable(n.DEPTH_TEST),n.useProgram(i.program);var l=new Array(16),u=new Array(16),_=new Array(16);r.identity(l),r.translate(l,0,0,-3.5),r.rotate(l,30*Math.sin(.01*c),1,0,0),r.rotate(l,1*c,0,1,0),r.copy(_,l),r.invert(_),r.transpose(_),r.mult(u,this.matPrj,l),n.uniformMatrix4fv(this.locMtxMV,!1,l),n.uniformMatrix4fv(this.locMtxPMV,!1,u),n.uniformMatrix4fv(this.locMtxMVIT,!1,_),n.uniform3f(this.locColor,.5,.5,.5),n.uniform1f(this.locAlpha,.8),n.activeTexture(n.TEXTURE0),this.video.ready?(t.update_video_texture(n,this.video),n.bindTexture(n.TEXTURE_2D,this.video.texid)):n.bindTexture(n.TEXTURE_2D,a),n.uniform1i(i.loc_smp,0),n.enableVertexAttribArray(i.loc_vtx),n.enableVertexAttribArray(i.loc_uv),n.disableVertexAttribArray(i.loc_nrm),n.bindBuffer(n.ARRAY_BUFFER,this.vboUv),n.vertexAttribPointer(i.loc_uv,2,n.FLOAT,!1,0,0),n.enable(n.BLEND),n.blendFuncSeparate(n.SRC_ALPHA,n.ONE_MINUS_SRC_ALPHA,n.ONE,n.ONE_MINUS_SRC_ALPHA);for(let e=0;e<6;e++){n.bindBuffer(n.ARRAY_BUFFER,this.vboVtx),n.vertexAttribPointer(i.loc_vtx,3,n.FLOAT,!1,0,48*e);var s=o[3*e+0],d=o[3*e+1],f=o[3*e+2];n.vertexAttrib3f(i.loc_nrm,s,d,f),n.drawArrays(n.TRIANGLE_STRIP,0,4)}n.disable(n.BLEND),this.count++,requestAnimationFrame((e=>this.renderMain(e)))}runMainLoop(){requestAnimationFrame((e=>this.renderMain(e)))}}window.startWebGL=function(e){try{n=new c,n.initialize(e),n.loadScene(),n.runMainLoop()}catch(e){alert(`エラーが発生しました。\n${e.message}(${e.stack})`)}}})();